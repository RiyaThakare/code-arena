<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>X-ray Analysis</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, sans-serif;
      background: #f6f9fc;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    h1 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 5px;
    }

    .subtitle {
      text-align: center;
      font-size: 14px;
      color: #666;
      margin-bottom: 30px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    .card h2 {
      font-size: 18px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card img {
      max-width: 100%;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    .btn {
      display: inline-block;
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      transition: all 0.2s;
    }

    .btn-gradient {
      background: linear-gradient(90deg, #16c9f6, #3ad29f);
      color: white;
    }

    .btn-outline {
      background: #f8f9fa;
      border: 1px solid #ccc;
    }

    .btn:hover {
      opacity: 0.9;
    }

    .findings, .recommendations {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }

    .important {
      background: #fff8e5;
      border: 1px solid #f5d580;
      border-radius: 8px;
      padding: 12px;
      font-size: 13px;
      color: #333;
    }

    ul {
      padding-left: 20px;
      margin: 0;
    }

    li {
      margin-bottom: 6px;
    }

    /* Disclaimer + Share button */
    .disclaimer-section {
      text-align: center;
      margin-top: 20px;
    }

    .share-btn {
      background: linear-gradient(90deg, #4facfe, #00f2fe);
      color: white;
      font-size: 16px;
      font-weight: 500;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 15px;
      transition: 0.3s ease;
    }

    .share-btn:hover {
      background: linear-gradient(90deg, #43e97b, #38f9d7);
      transform: translateY(-2px);
    }

    .disclaimer {
      background: #fffbea;
      border: 1px solid #ffe58f;
      color: #333;
      font-size: 14px;
      line-height: 1.5;
      padding: 12px 18px;
      border-radius: 8px;
      max-width: 900px;
      margin: 0 auto;
    }
  </style>
</head>
<body>

  <a href="Code_arena3.html" style="text-decoration:none; color:#333;">‚Üê Back to Analysis</a>

  <h1>X-ray Analysis</h1>
  <p class="subtitle">AI-powered medical imaging analysis</p>

  <!-- Grid Layout -->
  <div class="grid">
    <!-- Patient Information -->
    <div class="card" id="patientInfo">
      <h2>üë§ Patient Information</h2>
      <p><strong>Name:</strong> Loading...</p>
      <p><strong>Age:</strong> Loading...</p>
      <p><strong>Body Part:</strong> Loading...</p>
      <p><strong>Initial Diagnosis:</strong> Loading...</p>
    </div>

    <!-- X-ray Image -->
    <div class="card">
      <h2>üñºÔ∏è X-ray Image</h2>
      <img id="xrayImage" src="" alt="X-ray Image">
      <button class="btn btn-outline" onclick="downloadImage()">‚¨á Download Image</button>
    </div>

    <!-- AI Analysis -->
    <div class="card">
      <h2>üß† AI Analysis</h2>
      <p style="color: green; font-weight: bold;">Analysis Complete</p>
      <p>Confidence: 92%</p>
      <button class="btn btn-gradient">Re-analyze</button>
    </div>
  </div>

  <!-- Findings and Recommendations -->
  <div class="findings">
    <div class="card">
      <h2>üìå Key Findings</h2>
      <ul>
        <li>No acute fractures detected</li>
        <li>Bone density appears normal for age</li>
        <li>Joint spaces are well-preserved</li>
        <li>No signs of infection or inflammation</li>
      </ul>
    </div>

    <div class="card">
      <h2>üìÖ Recommendations</h2>
      <ul>
        <li>Continue current treatment plan</li>
        <li>Follow-up in 6 weeks if symptoms persist</li>
        <li>Consider physical therapy for mobility improvement</li>
      </ul>
    </div>
  </div>

  <!-- Important Notice + Share -->
  <div class="disclaimer-section">
    <button class="share-btn" onclick="shareReport()">üì§ Share Report</button>
    <div class="disclaimer">
      <strong>Important:</strong> This AI analysis is for reference only and should not replace professional medical diagnosis. 
      Always consult with a qualified radiologist or physician for final interpretation.
    </div>
  </div>

<script>
  // Load patient info & X-ray from localStorage
  window.onload = () => {
    const name = localStorage.getItem("patientName") || "N/A";
    const age = localStorage.getItem("patientAge") || "N/A";
    const bodyPart = localStorage.getItem("patientBodyPart") || "N/A";
    const diagnosis = localStorage.getItem("patientDiagnosis") || "N/A";
    const savedImage = localStorage.getItem("xrayImage");

    document.getElementById("patientInfo").innerHTML = `
      <h2>üë§ Patient Information</h2>
      <p><strong>Name:</strong> ${name}</p>
      <p><strong>Age:</strong> ${age}</p>
      <p><strong>Body Part:</strong> ${bodyPart}</p>
      <p><strong>Initial Diagnosis:</strong> ${diagnosis}</p>
    `;

    if (savedImage) {
      document.getElementById("xrayImage").src = savedImage;
    }
  };

  // Download Image
  function downloadImage() {
    const img = document.getElementById("xrayImage");
    if (!img.src) return alert("No image available");
    const link = document.createElement("a");
    link.href = img.src;
    link.download = "Xray_Image.jpg";
    link.click();
  }

  // Share Report
  async function shareReport() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    
    document.querySelector(".btn").addEventListener("click", function () {
    // Get values from form fields
    const name = document.getElementById("fullname").value;
    const age = document.getElementById("age").value;
    const bodyPart = document.getElementById("bodypart").value;
    const diagnosis = document.getElementById("notes").value;

    // Save to localStorage
    localStorage.setItem("patientName", name);
    localStorage.setItem("patientAge", age);
    localStorage.setItem("patientBodyPart", bodyPart);
    localStorage.setItem("patientDiagnosis", diagnosis);

    // Redirect to analysis page
    window.location.href = "Code_arena3.html";
  });

    doc.setFont("helvetica", "bold");
    doc.setFontSize(16);
    doc.text("X-ray Analysis Report", 20, 20);

    doc.setFontSize(12);
    doc.setFont("helvetica", "normal");
    doc.text("Patient: " + name, 20, 40);
    doc.text("Age: " + age, 20, 50);
    doc.text("Body Part: " + bodyPart, 20, 60);
    doc.text("Diagnosis: " + diagnosis, 20, 70);
    doc.text("Key Findings: No acute fractures detected", 20, 90);

    const pdfBlob = doc.output("blob");

    if (navigator.canShare && navigator.canShare({ files: [new File([pdfBlob], "Xray_Report.pdf", { type: "application/pdf" })] })) {
      const file = new File([pdfBlob], "Xray_Report.pdf", { type: "application/pdf" });
      try {
        await navigator.share({
          title: "X-ray Analysis Report",
          text: "Here is the patient‚Äôs X-ray analysis report.",
          files: [file]
        });
      } catch (err) {
        console.error("Share failed:", err.message);
      }
    } else {
      alert("Sharing not supported on this device. The PDF will be downloaded instead.");
      doc.save("Xray_Report.pdf");
    }
  }
</script>

</body>
</html>



